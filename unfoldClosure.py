from ROOT import RooUnfold
from ROOT import RooUnfoldResponse
from ROOT import RooUnfoldInvert
from ROOT import RooUnfoldBayes
from ROOT import RooUnfoldSvd
from ROOT import RooUnfoldTUnfold
import ROOT
import numpy
from ROOT import TUnfoldDensity
from unfoldHandle import unfoldHandle
#import TUnfoldIterativeEM


def average(hist):
	for i in range(hist.GetNbinsX()+2):
		val=hist.GetBinContent(i)
		err=hist.GetBinError(i)
		wid=hist.GetBinWidth(i)
		val=val/wid
		err=err/wid
		hist.SetBinContent(i,val)
		hist.SetBinError(i,err)
def reAverage(hist):
        for i in range(hist.GetNbinsX()+2):
                val=hist.GetBinContent(i)
                err=hist.GetBinError(i)
                wid=hist.GetBinWidth(i)
                val=val*wid
                err=err*wid
                hist.SetBinContent(i,val)
                hist.SetBinError(i,err)
def closureTest(hreco,handle):
	hist1=handle.doUnfold(hreco)
	hist2=handle.doUnfold(hreco,iteration=4)
	average(hist1)
	average(hist2)
	return [hist1,hist2]

lumi_el = [35.9*1000,41.529*1000,59.97*1000]
lumi_mu = [36.3*1000,42.135*1000,61.608*1000]
zScale_el_bb=[0.902374,0.949371,0.950691]
zScale_el_be=[0.874569,0.938017,0.953648]
zScale_mu=[1.0282,1.0062,0.9727]

f1=ROOT.TFile.Open("ResponseMatrix_e_V2.root")
f2=ROOT.TFile.Open("ResponseMatrix_mu_V2.root")
f3=ROOT.TFile.Open("unfoldingData.root")
f4=ROOT.TFile.Open("unfoldingMC.root")
f5=ROOT.TFile.Open("responseMatrices.root")
genBB2018_e=f1.Get("genBB2018_e")
recBB2018_e=f1.Get("recBB2018_e")
genBE2018_e=f1.Get("genBE2018_e")
recBE2018_e=f1.Get("recBE2018_e")
genBB2017_e=f1.Get("genBB2017_e")
recBB2017_e=f1.Get("recBB2017_e")
genBE2017_e=f1.Get("genBE2017_e")
recBE2017_e=f1.Get("recBE2017_e")
genBB2016_e=f1.Get("genBB2016_e")
recBB2016_e=f1.Get("recBB2016_e")
genBE2016_e=f1.Get("genBE2016_e")
recBE2016_e=f1.Get("recBE2016_e")
genBB2018_mu=f2.Get("genBB2018_mu")
recBB2018_mu=f2.Get("recBB2018_mu")
genBE2018_mu=f2.Get("genBE2018_mu")
recBE2018_mu=f2.Get("recBE2018_mu")
genBB2017_mu=f2.Get("genBB2017_mu")
recBB2017_mu=f2.Get("recBB2017_mu")
genBE2017_mu=f2.Get("genBE2017_mu")
recBE2017_mu=f2.Get("recBE2017_mu")
genBB2016_mu=f2.Get("genBB2016_mu")
recBB2016_mu=f2.Get("recBB2016_mu")
genBE2016_mu=f2.Get("genBE2016_mu")
recBE2016_mu=f2.Get("recBE2016_mu")

reMBB2016_e=f5.Get("rebinMBB2016_el")
reMBE2016_e=f5.Get("rebinMBE2016_el")
reMBB2017_e=f5.Get("rebinMBB2017_el")
reMBE2017_e=f5.Get("rebinMBE2017_el")
reMBB2018_e=f5.Get("rebinMBB2018_el")
reMBE2018_e=f5.Get("rebinMBE2018_el")
reMBB2016_mu=f5.Get("rebinMBB2016_mu")
reMBE2016_mu=f5.Get("rebinMBE2016_mu")
reMBB2017_mu=f5.Get("rebinMBB2017_mu")
reMBE2017_mu=f5.Get("rebinMBE2017_mu")
reMBB2018_mu=f5.Get("rebinMBB2018_mu")
reMBE2018_mu=f5.Get("rebinMBE2018_mu")

datamubb2018=f3.Get("datamubb2018")
datamube2018=f3.Get("datamube2018")
datamubb2017=f3.Get("datamubb2017")
datamube2017=f3.Get("datamube2017")
datamubb2016=f3.Get("datamubb2016")
datamube2016=f3.Get("datamube2016")
dataebb2018=f3.Get("dataebb2018")
dataebe2018=f3.Get("dataebe2018")
dataebb2017=f3.Get("dataebb2017")
dataebe2017=f3.Get("dataebe2017")
dataebb2016=f3.Get("dataebb2016")
dataebe2016=f3.Get("dataebe2016")

bkgmubb2018=f4.Get("bkgmubb2018")
bkgmube2018=f4.Get("bkgmube2018")
bkgmubb2017=f4.Get("bkgmubb2017")
bkgmube2017=f4.Get("bkgmube2017")
bkgmubb2016=f4.Get("bkgmubb2016")
bkgmube2016=f4.Get("bkgmube2016")
bkgebb2018=f4.Get("bkgebb2018")
bkgebe2018=f4.Get("bkgebe2018")
bkgebb2017=f4.Get("bkgebb2017")
bkgebe2017=f4.Get("bkgebe2017")
bkgebb2016=f4.Get("bkgebb2016")
bkgebe2016=f4.Get("bkgebe2016")


handle2016_bb_el=unfoldHandle(reMBB2016_e.ProjectionY(),reMBB2016_e.ProjectionY(),reMBB2016_e,"BB2016el")
print handle2016_bb_el.getConditionN()
handle2016_be_el=unfoldHandle(reMBE2016_e.ProjectionY(),reMBE2016_e.ProjectionY(),reMBE2016_e,"BE2016el")
handle2017_bb_el=unfoldHandle(reMBB2017_e.ProjectionY(),reMBB2017_e.ProjectionY(),reMBB2017_e,"BB2017el")
handle2017_be_el=unfoldHandle(reMBE2017_e.ProjectionY(),reMBE2017_e.ProjectionY(),reMBE2017_e,"BE2017el")
handle2018_bb_el=unfoldHandle(reMBB2018_e.ProjectionY(),reMBB2018_e.ProjectionY(),reMBB2018_e,"BB2018el")
handle2018_be_el=unfoldHandle(reMBE2018_e.ProjectionY(),reMBE2018_e.ProjectionY(),reMBE2018_e,"BE2018el")
handle2016_bb_mu=unfoldHandle(reMBB2016_mu.ProjectionY(),reMBB2016_mu.ProjectionY(),reMBB2016_mu,"BB2016mu")
handle2016_be_mu=unfoldHandle(reMBE2016_mu.ProjectionY(),reMBE2016_mu.ProjectionY(),reMBE2016_mu,"BE2016mu")
handle2017_bb_mu=unfoldHandle(reMBB2017_mu.ProjectionY(),reMBB2017_mu.ProjectionY(),reMBB2017_mu,"BB2017mu")
handle2017_be_mu=unfoldHandle(reMBE2017_mu.ProjectionY(),reMBE2017_mu.ProjectionY(),reMBE2017_mu,"BE2017mu")
handle2018_bb_mu=unfoldHandle(reMBB2018_mu.ProjectionY(),reMBB2018_mu.ProjectionY(),reMBB2018_mu,"BB2018mu")
handle2018_be_mu=unfoldHandle(reMBE2018_mu.ProjectionY(),reMBE2018_mu.ProjectionY(),reMBE2018_mu,"BE2018mu")

reAverage(dataebe2016)
reAverage(bkgebe2016)
reAverage(dataebb2016)
reAverage(bkgebb2016)
reAverage(dataebe2017)
reAverage(bkgebe2017)
reAverage(dataebb2017)
reAverage(bkgebb2017)
reAverage(dataebe2018)
reAverage(bkgebe2018)
reAverage(dataebb2018)
reAverage(bkgebb2018)
reAverage(datamube2016)
reAverage(bkgmube2016)
reAverage(datamubb2016)
reAverage(bkgmubb2016)
reAverage(datamube2017)
reAverage(bkgmube2017)
reAverage(datamubb2017)
reAverage(bkgmubb2017)
reAverage(datamube2018)
reAverage(bkgmube2018)
reAverage(datamubb2018)
reAverage(bkgmubb2018)

bng=[200,300,400,500,690,900,1250,1610, 2000, 4000]                               
bng=numpy.asarray(bng,dtype=numpy.float64)
datamubb2018=datamubb2018.Rebin(len(bng)-1,"datamubb2018",bng)
datamube2018=datamubb2018.Rebin(len(bng)-1,"datamube2018",bng)
bkgmubb2018=bkgmubb2018.Rebin(len(bng)-1,"bkgmubb2018",bng)
bkgmube2018=bkgmube2018.Rebin(len(bng)-1,"bkgmube2018",bng)
dataebb2018=datamubb2018.Rebin(len(bng)-1,"dataebb2018",bng)
dataebe2018=datamubb2018.Rebin(len(bng)-1,"dataebe2018",bng)
bkgebb2018=bkgmubb2018.Rebin(len(bng)-1,"bkgebb2018",bng)
bkgebe2018=bkgmube2018.Rebin(len(bng)-1,"bkgebe2018",bng)
datamubb2017=datamubb2017.Rebin(len(bng)-1,"datamubb2017",bng)
datamube2017=datamubb2017.Rebin(len(bng)-1,"datamube2017",bng)
bkgmubb2017=bkgmubb2018.Rebin(len(bng)-1,"bkgmubb2017",bng)
bkgmube2017=bkgmube2017.Rebin(len(bng)-1,"bkgmube2017",bng)
dataebb2017=datamubb2018.Rebin(len(bng)-1,"dataebb2017",bng)
dataebe2017=datamubb2017.Rebin(len(bng)-1,"dataebe2017",bng)
bkgebb2017=bkgmubb2017.Rebin(len(bng)-1,"bkgebb2017",bng)
bkgebe2017=bkgmube2017.Rebin(len(bng)-1,"bkgebe2017",bng)
datamubb2016=datamubb2016.Rebin(len(bng)-1,"datamubb2016",bng)
datamube2016=datamubb2016.Rebin(len(bng)-1,"datamube2016",bng)
bkgmubb2016=bkgmubb2016.Rebin(len(bng)-1,"bkgmubb2016",bng)
bkgmube2016=bkgmube2016.Rebin(len(bng)-1,"bkgmube2016",bng)
dataebb2016=datamubb2016.Rebin(len(bng)-1,"dataebb2016",bng)
dataebe2016=datamubb2016.Rebin(len(bng)-1,"dataebe2016",bng)
bkgebb2016=bkgmubb2016.Rebin(len(bng)-1,"bkgebb2016",bng)
bkgebe2016=bkgmube2016.Rebin(len(bng)-1,"bkgebe2016",bng)

genBE2018_e=genBE2018_e.Rebin(len(bng)-1,"genBE2018_e",bng)
genBB2018_e=genBB2018_e.Rebin(len(bng)-1,"genBB2018_e",bng)
recBE2018_e=recBE2018_e.Rebin(len(bng)-1,"recBE2018_e",bng)
recBB2018_e=recBB2018_e.Rebin(len(bng)-1,"recBB2018_e",bng)
genBE2017_e=genBE2017_e.Rebin(len(bng)-1,"genBE2017_e",bng)
genBB2017_e=genBB2017_e.Rebin(len(bng)-1,"genBB2017_e",bng)
recBE2017_e=recBE2017_e.Rebin(len(bng)-1,"recBE2017_e",bng)
recBB2017_e=recBB2017_e.Rebin(len(bng)-1,"recBB2017_e",bng)
genBE2016_e=genBE2016_e.Rebin(len(bng)-1,"genBE2016_e",bng)
genBB2016_e=genBB2016_e.Rebin(len(bng)-1,"genBB2016_e",bng)
recBE2016_e=recBE2016_e.Rebin(len(bng)-1,"recBE2016_e",bng)
recBB2016_e=recBB2016_e.Rebin(len(bng)-1,"recBB2016_e",bng)
genBE2018_mu=genBE2018_mu.Rebin(len(bng)-1,"genBE2018_mu",bng)
genBB2018_mu=genBB2018_mu.Rebin(len(bng)-1,"genBB2018_mu",bng)
recBE2018_mu=recBE2018_mu.Rebin(len(bng)-1,"recBE2018_mu",bng)
recBB2018_mu=recBB2018_mu.Rebin(len(bng)-1,"recBB2018_mu",bng)
genBE2017_mu=genBE2017_mu.Rebin(len(bng)-1,"genBE2017_mu",bng)
genBB2017_mu=genBB2017_mu.Rebin(len(bng)-1,"genBB2017_mu",bng)
recBE2017_mu=recBE2017_mu.Rebin(len(bng)-1,"recBE2017_mu",bng)
recBB2017_mu=recBB2017_mu.Rebin(len(bng)-1,"recBB2017_mu",bng)
genBE2016_mu=genBE2016_mu.Rebin(len(bng)-1,"genBE2016_mu",bng)
genBB2016_mu=genBB2016_mu.Rebin(len(bng)-1,"genBB2016_mu",bng)
recBE2016_mu=recBE2016_mu.Rebin(len(bng)-1,"recBE2016_mu",bng)
recBB2016_mu=recBB2016_mu.Rebin(len(bng)-1,"recBB2016_mu",bng)
File1=ROOT.TFile("ClosureTest.root","RECREATE")

closureTest(recBB2016_e,handle2016_bb_el)[0].Write()
closureTest(recBB2016_e,handle2016_bb_el)[1].Write()
average(recBB2016_e)
recBB2016_e.Write()
average(genBB2016_e)
genBB2016_e.Write()

closureTest(recBE2016_e,handle2016_be_el)[0].Write()
closureTest(recBE2016_e,handle2016_be_el)[1].Write()
average(recBE2016_e)
recBE2016_e.Write()
average(genBE2016_e)
genBE2016_e.Write()

closureTest(recBB2017_e,handle2017_bb_el)[0].Write()
closureTest(recBB2017_e,handle2017_bb_el)[1].Write()
average(recBB2017_e)
recBB2017_e.Write()
average(genBB2017_e)
genBB2017_e.Write()

closureTest(recBE2017_e,handle2017_be_el)[0].Write()
closureTest(recBE2017_e,handle2017_be_el)[1].Write()
average(recBE2017_e)
recBE2017_e.Write()
average(genBE2017_e)
genBE2017_e.Write()

closureTest(recBB2018_e,handle2018_bb_el)[0].Write()
closureTest(recBB2018_e,handle2018_bb_el)[1].Write()
average(recBB2018_e)
recBB2018_e.Write()
average(genBB2018_e)
genBB2018_e.Write()

closureTest(recBE2018_e,handle2018_be_el)[0].Write()
closureTest(recBE2018_e,handle2018_be_el)[1].Write()
average(recBE2018_e)
recBE2018_e.Write()
average(genBE2018_e)
genBE2018_e.Write()

closureTest(recBB2016_mu,handle2016_bb_mu)[0].Write()
closureTest(recBB2016_mu,handle2016_bb_mu)[1].Write()
average(recBB2016_mu)
recBB2016_mu.Write()
average(genBB2016_mu)
genBB2016_mu.Write()

closureTest(recBE2016_mu,handle2016_be_mu)[0].Write()
closureTest(recBE2016_mu,handle2016_be_mu)[1].Write()
average(recBE2016_mu)
recBE2016_mu.Write()
average(genBE2016_mu)
genBE2016_mu.Write()

closureTest(recBB2017_mu,handle2017_bb_mu)[0].Write()
closureTest(recBB2017_mu,handle2017_bb_mu)[1].Write()
average(recBB2017_mu)
recBB2017_mu.Write()
average(genBB2017_mu)
genBB2017_mu.Write()

closureTest(recBE2017_mu,handle2017_be_mu)[0].Write()
closureTest(recBE2017_mu,handle2017_be_mu)[1].Write()
average(recBE2017_mu)
recBE2017_mu.Write()
average(genBE2017_mu)
genBE2017_mu.Write()

closureTest(recBB2018_mu,handle2018_bb_mu)[0].Write()
closureTest(recBB2018_mu,handle2018_bb_mu)[1].Write()
average(recBB2018_mu)
recBB2018_mu.Write()
average(genBB2018_mu)
genBB2018_mu.Write()

closureTest(recBE2018_mu,handle2018_be_mu)[0].Write()
closureTest(recBE2018_mu,handle2018_be_mu)[1].Write()
average(recBE2018_mu)
recBE2018_mu.Write()
average(genBE2018_mu)
genBE2018_mu.Write()
File1.Close()

File2=ROOT.TFile("UnfoldedSample.root","RECREATE")
dataebe2016_int=handle2016_be_el.doUnfold(dataebe2016,bkgebe2016)
dataebe2016_iter4=handle2016_be_el.doUnfold(dataebe2016,bkgebe2016,iteration=4)
dataebe2016_iter40=handle2016_be_el.doUnfold(dataebe2016,bkgebe2016,iteration=40)
dataebe2016_iter400=handle2016_be_el.doUnfold(dataebe2016,bkgebe2016,iteration=400)
average(dataebe2016_int)
average(dataebe2016_iter4)
average(dataebe2016_iter40)
average(dataebe2016_iter400)
dataebe2016_int.Write()
dataebe2016_iter4.Write()
dataebe2016_iter40.Write()
dataebe2016_iter400.Write()

dataebb2016_int=handle2016_bb_el.doUnfold(dataebb2016,bkgebb2016)
dataebb2016_iter4=handle2016_bb_el.doUnfold(dataebb2016,bkgebb2016,iteration=4)
dataebb2016_iter40=handle2016_bb_el.doUnfold(dataebb2016,bkgebb2016,iteration=40)
dataebb2016_iter400=handle2016_bb_el.doUnfold(dataebb2016,bkgebb2016,iteration=400)
average(dataebb2016_int)
average(dataebb2016_iter4)
average(dataebb2016_iter40)
average(dataebb2016_iter400)
dataebb2016_int.Write()
dataebb2016_iter4.Write()
dataebb2016_iter40.Write()
dataebb2016_iter400.Write()

dataebb2017_int=handle2017_bb_el.doUnfold(dataebb2017,bkgebb2017)
dataebb2017_iter4=handle2017_bb_el.doUnfold(dataebb2017,bkgebb2017,iteration=4)
dataebb2017_iter40=handle2017_bb_el.doUnfold(dataebb2017,bkgebb2017,iteration=40)
dataebb2017_iter400=handle2017_bb_el.doUnfold(dataebb2017,bkgebb2017,iteration=400)
average(dataebb2017_int)
average(dataebb2017_iter4)
average(dataebb2017_iter40)
average(dataebb2017_iter400)
dataebb2017_int.Write()
dataebb2017_iter4.Write()
dataebb2017_iter40.Write()
dataebb2017_iter400.Write()

dataebe2017_int=handle2016_be_el.doUnfold(dataebe2017,bkgebe2017)
dataebe2017_iter4=handle2017_be_el.doUnfold(dataebe2017,bkgebe2017,iteration=4)
dataebe2017_iter40=handle2017_be_el.doUnfold(dataebe2017,bkgebe2017,iteration=40)
dataebe2017_iter400=handle2017_be_el.doUnfold(dataebe2017,bkgebe2017,iteration=400)
average(dataebe2017_int)
average(dataebe2017_iter4)
average(dataebe2017_iter40)
average(dataebe2017_iter400)
dataebe2017_int.Write()
dataebe2017_iter4.Write()
dataebe2017_iter40.Write()
dataebe2017_iter400.Write()

dataebb2018_int=handle2018_bb_el.doUnfold(dataebb2016,bkgebb2016)
dataebb2018_iter4=handle2018_bb_el.doUnfold(dataebb2018,bkgebb2018,iteration=4)
dataebb2018_iter40=handle2018_bb_el.doUnfold(dataebb2018,bkgebb2018,iteration=40)
dataebb2018_iter400=handle2018_bb_el.doUnfold(dataebb2018,bkgebb2018,iteration=400)
average(dataebb2018_int)
average(dataebb2018_iter4)
average(dataebb2018_iter40)
average(dataebb2018_iter400)
dataebb2018_int.Write()
dataebb2018_iter4.Write()
dataebb2018_iter40.Write()
dataebb2018_iter400.Write()

dataebe2018_int=handle2018_be_el.doUnfold(dataebe2018,bkgebe2018)
dataebe2018_iter4=handle2018_be_el.doUnfold(dataebe2018,bkgebe2018,iteration=4)
dataebe2018_iter40=handle2018_be_el.doUnfold(dataebe2018,bkgebe2018,iteration=40)
dataebe2018_iter400=handle2018_be_el.doUnfold(dataebe2018,bkgebe2018,iteration=400)
average(dataebe2018_int)
average(dataebe2018_iter4)
average(dataebe2018_iter40)
average(dataebe2018_iter400)
dataebe2018_int.Write()
dataebe2018_iter4.Write()
dataebe2018_iter40.Write()
dataebe2018_iter400.Write()

datamubb2016_int=handle2016_bb_mu.doUnfold(datamubb2016,bkgmubb2016)
datamubb2016_iter4=handle2016_bb_mu.doUnfold(datamubb2016,bkgmubb2016,iteration=4)
datamubb2016_iter40=handle2016_bb_mu.doUnfold(datamubb2016,bkgmubb2016,iteration=40)
datamubb2016_iter400=handle2016_bb_mu.doUnfold(datamubb2016,bkgmubb2016,iteration=400)
average(datamubb2016_int)
average(datamubb2016_iter4)
average(datamubb2016_iter40)
average(datamubb2016_iter400)
datamubb2016_int.Write()
datamubb2016_iter4.Write()
datamubb2016_iter40.Write()
datamubb2016_iter400.Write()

datamube2016_int=handle2016_be_mu.doUnfold(datamube2016,bkgmube2016)
datamube2016_iter4=handle2016_be_mu.doUnfold(datamube2016,bkgmube2016,iteration=4)
datamube2016_iter40=handle2016_be_mu.doUnfold(datamube2016,bkgmube2016,iteration=40)
datamube2016_iter400=handle2016_be_mu.doUnfold(datamube2016,bkgmube2016,iteration=400)
average(datamube2016_int)
average(datamube2016_iter4)
average(datamube2016_iter40)
average(datamube2016_iter400)
datamube2016_int.Write()
datamube2016_iter4.Write()
datamube2016_iter40.Write()
datamube2016_iter400.Write()

datamubb2017_int=handle2017_bb_mu.doUnfold(datamubb2017,bkgmubb2017)
datamubb2017_iter4=handle2017_bb_mu.doUnfold(datamubb2017,bkgmubb2017,iteration=4)
datamubb2017_iter40=handle2017_bb_mu.doUnfold(datamubb2017,bkgmubb2017,iteration=40)
datamubb2017_iter400=handle2017_bb_mu.doUnfold(datamubb2017,bkgmubb2017,iteration=400)
average(datamubb2017_int)
average(datamubb2017_iter4)
average(datamubb2017_iter40)
average(datamubb2017_iter400)
datamubb2017_int.Write()
datamubb2017_iter4.Write()
datamubb2017_iter40.Write()
datamubb2017_iter400.Write()

datamube2017_int=handle2017_be_mu.doUnfold(datamube2017,bkgmube2017)
datamube2017_iter4=handle2017_be_mu.doUnfold(datamube2017,bkgmube2017,iteration=4)
datamube2017_iter40=handle2017_be_mu.doUnfold(datamube2017,bkgmube2017,iteration=40)
datamube2017_iter400=handle2017_be_mu.doUnfold(datamube2017,bkgmube2017,iteration=400)
average(datamube2017_int)
average(datamube2017_iter4)
average(datamube2017_iter40)
average(datamube2017_iter400)
datamube2017_int.Write()
datamube2017_iter4.Write()
datamube2017_iter40.Write()
datamube2017_iter400.Write()

datamubb2018_int=handle2018_bb_mu.doUnfold(datamubb2018,bkgmubb2018)
datamubb2018_iter4=handle2018_bb_mu.doUnfold(datamubb2018,bkgmubb2018,iteration=4)
datamubb2018_iter40=handle2018_bb_mu.doUnfold(datamubb2018,bkgmubb2018,iteration=40)
datamubb2018_iter400=handle2018_bb_mu.doUnfold(datamubb2018,bkgmubb2018,iteration=400)
average(datamubb2018_int)
average(datamubb2018_iter4)
average(datamubb2018_iter40)
average(datamubb2018_iter400)
datamubb2018_int.Write()
datamubb2018_iter4.Write()
datamubb2018_iter40.Write()
datamubb2018_iter400.Write()

datamube2018_int=handle2018_be_mu.doUnfold(datamube2018,bkgmube2018)
datamube2018_iter4=handle2018_be_mu.doUnfold(datamube2018,bkgmube2018,iteration=4)
datamube2018_iter40=handle2018_be_mu.doUnfold(datamube2018,bkgmube2018,iteration=40)
datamube2018_iter400=handle2018_be_mu.doUnfold(datamube2018,bkgmube2018,iteration=400)
average(datamube2018_int)
average(datamube2018_iter4)
average(datamube2018_iter40)
average(datamube2018_iter400)
datamube2018_int.Write()
datamube2018_iter4.Write()
datamube2018_iter40.Write()
datamube2018_iter400.Write()

File2.Close()

